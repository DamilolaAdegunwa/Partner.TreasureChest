@using Abp.Json
@using WuLong.Lims.CRM.Subcontractors.Dto
@model GetSubcontractorForEditOutput
@section styles{
    <style type="text/css">
        html {
            background-color: #fafafa;
        }
    </style>
}

<div class="layui-fluid">
    <form class="layui-form" lay-filter="layuiadmin-form-subcontractor" style="padding: 15px 0 0 0;">
        <input type="hidden" name="id" />
        <div class="layui-form-item">
            <label class="layui-form-label">分包商名称</label>
            <div class="layui-input-block">
                <input name="name" class="layui-input" type="text" placeholder="请输入分包商名称" autocomplete="off" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地址</label>
            <div class="layui-input-block">
                <input name="address" class="layui-input" type="text" placeholder="请输入地址" autocomplete="off" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">联系人</label>
                <div class="layui-input-inline">
                    <input name="contacts" class="layui-input" type="text" placeholder="请输入联系人" autocomplete="off" lay-verify="required">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">联系电话</label>
                <div class="layui-input-inline">
                    <input name="contactPhoneNo" class="layui-input" type="text" placeholder="请输入联系电话" autocomplete="off" lay-verify="required|phone">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">传真</label>
            <div class="layui-input-inline">
                <input name="fax" class="layui-input" type="text" placeholder="请输入传真" autocomplete="off">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea name="desc" class="layui-textarea" placeholder="请输入备注"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-hide">
            <label class="layui-form-label">营业执照</label>
            <div class="layui-input-block">
                <textarea class="layui-textarea" placeholder="请输入传真"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn layui-hide" lay-submit lay-filter="LAY-subcontractor-front-submit" id="LAY-subcontractor-front-submit">立即提交</button>
            </div>
        </div>
    </form>
</div>

@section scripts{
    <script type="text/javascript">
        layui.config({
            base: '/lib/layui-extend-modules/' //静态资源所在路径
        }).use(['jquery', 'form', 'layer', 'table'], function () {
            var $ = layui.$,
                form = layui.form;

            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.iframeAuto(index);

            //初始化表单
            form.val("layuiadmin-form-subcontractor",@Html.Raw(JsonExtensions.ToJsonString(Model.Subcontractor,true,false)));
            form.render();

            //触发表单提交
            layui.submitForm = function(){
                $("#LAY-subcontractor-front-submit").click();
            }

            //表单提交
            form.on('submit(LAY-subcontractor-front-submit)', function (data) {
                var field = {
                    subcontractor: data.field, //获取提交的字段
                };

                var waitIndex = parent.layer.load(2);
                abp.ajax({
                    url: "@Url.Action("CreateOrUpdateSubcontractor", "Subcontractor", new { area="CRM" })",
                    data: JSON.stringify(field),
                    abpHandleError: false
                }).done(function (data) {
                    if (data.code == 200) {
                        data.index = index;
                        parent.layui.currWindow().layui.callback(data);
                    }
                }).fail(function (jqXHR) {
                    parent.layer.msg(jqXHR.message, { icon: 5 });
                }).always(function () {
                    parent.layer.close(waitIndex);
                });

                return false;
            });
        });
    </script>
}